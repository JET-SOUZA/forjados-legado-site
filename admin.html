<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gerar Index de Fotos</title>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    button { margin-top: 10px; padding: 10px 20px; font-size: 16px; }
    #log { white-space: pre-wrap; background: #f5f5f5; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>Gerar Index de Fotos do Evento</h1>
  <p>Essa p√°gina carrega as fotos listadas em <code>fotos.json</code>, detecta rostos e gera o arquivo <code>event-index.json</code>.</p>
  <button id="start">Gerar index</button>
  <div id="log"></div>

  <script>
    const log = msg => document.getElementById('log').textContent += msg + '\n';

    document.getElementById('start').onclick = async () => {
      log('üß† Carregando modelos locais...');

      // Caminho corrigido para os modelos
  await faceapi.nets.tinyFaceDetector.loadFromUri('Forjados/Forjados/models');
await faceapi.nets.faceLandmark68Net.loadFromUri('Forjados/Forjados/models');
await faceapi.nets.faceRecognitionNet.loadFromUri('Forjados/Forjados/models');
      log('‚úÖ Modelos carregados com sucesso.');

      log('üì∏ Carregando fotos.json...');
      const res = await fetch('./fotos.json');
      const fotos = await res.json();
      log(Encontradas ${fotos.length} fotos.);

      const resultados = [];

      const options = new faceapi.TinyFaceDetectorOptions({ 
        inputSize: 416, 
        scoreThreshold: 0.5 
      });

      for (const [i, foto] of fotos.entries()) {
        log(\nüñºÔ∏è Processando ${i + 1}/${fotos.length}: ${foto.nome});
        try {
          const img = await faceapi.fetchImage(foto.url);
          const detection = await faceapi
            .detectSingleFace(img, options)
            .withFaceLandmarks()
            .withFaceDescriptor();

          if (detection) {
            resultados.push({
              nome: foto.nome,
              url: foto.url,
              descriptor: Array.from(detection.descriptor)
            });
            log(` ‚Üí Rosto detectado ‚úÖ`);
          } else {
            log(` ‚Üí Nenhum rosto encontrado ‚ö†Ô∏è`);
          }
        } catch (e) {
          log(‚ùå Erro na imagem ${foto.nome}: ${e});
        }
      }

      const blob = new Blob([JSON.stringify(resultados, null, 2)], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'event-index.json';
      link.click();

      log('\nüéâ Conclu√≠do! O arquivo event-index.json foi baixado.');
    };
  </script>
</body>
</html>
